<!DOCTYPE html>
<html>

<head>
	<style>
		* {
			box-sizing: border-box;
		}
		
		body {
			font-family: Arial, Helvetica, sans-serif;
		}
		
		/* Style the header */
		header {
			background-color: rgb(0, 0, 0);
			padding: 30px;
			text-align: center;
			font-size: 35px;
			color: white;
		}
		h1 {
			padding: 30px;
			text-align: center;
			font-size: 35px;
			opacity: 0;
		}
	</style>
</head>

<body>
<header>Posture Sensor Demo</header>
<h1> Bad Posture </h1>
</body>

<script src="https://d3js.org/d3.v7.min.js"></script>

<script type="application/javascript">
	var slouch = "not slouch";
	const SERVERADDRESS = "http://127.0.0.1:3000"
	// use XML HTTP request to grab data from the server (central)
	let xmlhttp = new XMLHttpRequest()
	let http = new XMLHttpRequest();
	xmlhttp.onreadystatechange = function () {
		if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
			let responseText = xmlhttp.responseText
			let sensorValue = parseFloat(JSON.parse(responseText).sensorValue)
			if(sensorValue > -0.9) {
				d3.select("body").style("background-color", "rgb(255,105,97)")
				d3.select("h1").style("opacity", "100")
				slouch = 1;
			} else {
				d3.select("body").style("background-color", "rgb(119,221,119)")
				d3.select("h1").style("opacity", "0")
				slouch = 0;
			}
		}
	}
	// periodically grab data
	let getData = () => {
		var params = JSON.stringify({slouch: slouch});
		var data = new FormData();
		data.append('slouch', slouch);
		xmlhttp.open("POST", SERVERADDRESS, true)
		xmlhttp.setRequestHeader("Content-Type","application/json")
		xmlhttp.setRequestHeader("Content-length", params.length);
		
		xmlhttp.send(params)

		setTimeout(() => {
			getData()
		}, 10)
	}
	getData()
</script>

</html>